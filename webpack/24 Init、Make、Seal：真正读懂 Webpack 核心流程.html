<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>掘金小册子 | 掘金小册子</title>
    <meta name="description" content="自用的掘金小册">
    <link rel="stylesheet" href="/smallVolumesStore/assets/style.77d4fcc5.css">
    <link rel="modulepreload" href="/smallVolumesStore/assets/app.02b33377.js">
    <link rel="modulepreload" href="/smallVolumesStore/assets/webpack_24 Init、Make、Seal：真正读懂 Webpack 核心流程.md.58bb3c7c.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-ca9ccb7e><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-ca9ccb7e data-v-a71a30f1><div class="VPNavBar has-sidebar" data-v-a71a30f1 data-v-a35e6f52><div class="container" data-v-a35e6f52><div class="VPNavBarTitle has-sidebar" data-v-a35e6f52 data-v-d5925166><a class="title" href="/smallVolumesStore/" data-v-d5925166><!--[--><!--]--><!----><!--[-->掘金小册子<!--]--><!--[--><!--]--></a></div><div class="content" data-v-a35e6f52><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a35e6f52 data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/smallVolumesStore/webpack/1%20%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86%20Webpack%EF%BC%9A%E6%97%A7%E6%97%B6%E4%BB%A3%E7%9A%84%E7%A0%B4%E5%B1%80%E8%80%85.html" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Webpack5核心原理与应用实践<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/smallVolumesStore/electron/1.%E5%BC%80%E7%AF%87-%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B%E5%92%8C%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.html" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Electron简历平台实战<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/smallVolumesStore/design/1%20%E5%BC%80%E7%AF%87%EF%BC%9A%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E6%88%90%E9%95%BF%E8%AE%BA.html" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->JavaScript设计模式核心原理与应用实践<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/smallVolumesStore/tsguide/1.%E5%BC%80%E7%AF%87%EF%BC%9A%E7%94%A8%E6%AD%A3%E7%A1%AE%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0%20TypeScript.html" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->TypeScript全面进阶指南<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a35e6f52 data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-a3e7452b data-v-968780f1 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-968780f1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-968780f1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-a35e6f52 data-v-e89b88d7 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e89b88d7><div class="item appearance" data-v-e89b88d7><p class="label" data-v-e89b88d7>Appearance</p><div class="appearance-action" data-v-e89b88d7><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-e89b88d7 data-v-968780f1 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-968780f1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-968780f1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a35e6f52 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-ca9ccb7e data-v-aac27d5e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-aac27d5e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-aac27d5e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-aac27d5e>Menu</span></button><a class="top-link" href="#" data-v-aac27d5e> Return to top </a></div><aside class="VPSidebar" data-v-ca9ccb7e data-v-f332cb62><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-f332cb62><span class="visually-hidden" id="sidebar-aria-label" data-v-f332cb62> Sidebar Navigation </span><!--[--><div class="group" data-v-f332cb62><section class="VPSidebarGroup" data-v-f332cb62 data-v-2976c796><div class="title" data-v-2976c796><h2 class="title-text" data-v-2976c796>Webpack5</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/smallVolumesStore/webpack/1%20%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86%20Webpack%EF%BC%9A%E6%97%A7%E6%97%B6%E4%BB%A3%E7%9A%84%E7%A0%B4%E5%B1%80%E8%80%85.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>1 重新认识 Webpack：旧时代的破局者</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/2%20%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%20Webpack%20%E9%85%8D%E7%BD%AE%E5%BA%95%E5%B1%82%E7%BB%93%E6%9E%84%E9%80%BB%E8%BE%91.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>2 如何理解 Webpack 配置底层结构逻辑</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/3%20%E5%A6%82%E4%BD%95%E5%80%9F%E5%8A%A9%20Babel%20TS%20ESLint%20%E6%9E%84%E5%BB%BA%E7%8E%B0%E4%BB%A3%20JS%20%E5%B7%A5%E7%A8%8B%E7%8E%AF%E5%A2%83%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>3 如何借助 Babel TS ESLint 构建现代 JS 工程环境？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/4%20%E5%A6%82%E4%BD%95%E5%80%9F%E5%8A%A9%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8%E3%80%81PostCSS%20%E7%AD%89%E6%9E%84%E5%BB%BA%E7%8E%B0%E4%BB%A3%20CSS%20%E5%B7%A5%E7%A8%8B%E7%8E%AF%E5%A2%83%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>4 如何借助预处理器、PostCSS 等构建现代 CSS 工程环境？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/5%20%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%20Vue%20%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>5 如何搭建 Vue 全栈开发环境？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/6%20%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%20React%20%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>6 如何搭建 React 全栈开发环境？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/7%20%E4%BD%BF%E7%94%A8%20Webpack%20%E6%9E%84%E5%BB%BA%20NPM%20Library%20%E7%9A%84%E6%AD%A3%E7%A1%AE%E6%96%B9%E5%BC%8F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>7 使用 Webpack 构建 NPM Library 的正确方式</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/8%20%E4%BD%BF%E7%94%A8%20Webpack%20%E6%9E%84%E5%BB%BA%E5%BE%AE%E5%89%8D%E7%AB%AF%E5%BA%94%E7%94%A8.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>8 使用 Webpack 构建微前端应用</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/9%20%E5%A6%82%E4%BD%95%E5%80%9F%E5%8A%A9%20Webpack%20%E5%BC%80%E5%8F%91%20PWA%E3%80%81Node%E3%80%81Electron%20%E5%BA%94%E7%94%A8%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>9 如何借助 Webpack 开发 PWA、Node、Electron 应用？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/10%20%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%9B%BE%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>10 深入理解图像加载原理与最佳实践</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/11%20%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20Webpack%20%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%84.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>11 深入理解 Webpack 核心配置结构</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/12%20%E6%9E%84%E5%BB%BA%E6%80%A7%E8%83%BD%EF%BC%9A%E5%88%86%E4%BA%AB%207%20%E6%AC%BE%E5%B8%B8%E7%94%A8%E7%9A%84%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>12 构建性能：分享 7 款常用的性能分析工具</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/13%20%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%20Webpack%20%E6%8C%81%E4%B9%85%E5%8C%96%E7%BC%93%E5%AD%98%E5%A4%A7%E5%B9%85%E6%8F%90%E5%8D%87%E6%9E%84%E5%BB%BA%E6%80%A7%E8%83%BD%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>13 如何使用 Webpack 持久化缓存大幅提升构建性能？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/14%20Webpack%20%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C%E6%9E%84%E5%BB%BA%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>14 Webpack 都有哪些实现并行构建的方法？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/15%20%E6%9C%89%E5%93%AA%E4%BA%9B%E5%80%BC%E5%BE%97%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%9E%84%E5%BB%BA%E6%80%A7%E8%83%BD%E6%9E%81%E8%87%B4%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>15 有哪些值得学习的构建性能极致优化技巧？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/16%20%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8%20SplitChunks%E6%8F%90%E5%8D%87%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>16 如何正确使用 SplitChunks提升应用性能？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/17%20%E4%B8%8D%E6%AD%A2%20Terser%EF%BC%9A%E6%8F%AD%E7%A7%98%E4%BB%A3%E7%A0%81%E5%8E%8B%E7%BC%A9%E7%9A%84%E9%97%A8%E9%97%A8%E9%81%93%E9%81%93.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>17 不止 Terser：揭秘代码压缩的门门道道</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/18%20%E8%BF%98%E6%9C%89%E5%93%AA%E4%BA%9B%E5%80%BC%E5%BE%97%E5%AD%A6%E4%B9%A0%E7%9A%84%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E6%9E%81%E8%87%B4%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>18 还有哪些值得学习的应用性能极致优化技巧？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/19%20Loader%20%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80%EF%BC%9A%E4%BB%8E%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E5%AD%A6%E5%88%B0%E7%9A%84%20Loader%20%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>19 Loader 开发基础：从开源项目学到的 Loader 开发技巧</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/20%20Loader%20%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6%EF%BC%9A%E5%A6%82%E4%BD%95%E7%94%A8%E5%A5%BD%20Loader%20%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>20 Loader 开发进阶：如何用好 Loader 扩展开发工具？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/21%20%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80%EF%BC%9A%E5%AE%9E%E4%BE%8B%E5%89%96%E6%9E%90%E6%8F%92%E4%BB%B6%E5%9F%BA%E6%9C%AC%E5%BD%A2%E6%80%81%E4%B8%8E%E6%9E%B6%E6%9E%84%E9%80%BB%E8%BE%91.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>21 插件开发基础：实例剖析插件基本形态与架构逻辑</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/22%20%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6%EF%BC%9A%E5%A6%82%E4%BD%95%E6%8F%90%E5%8D%87%E6%8F%92%E4%BB%B6%E5%81%A5%E5%A3%AE%E6%80%A7%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>22 插件开发进阶：如何提升插件健壮性？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/23%20%E6%8F%92%E4%BB%B6%E6%9E%B6%E6%9E%84%EF%BC%9AHook%20%E4%BD%93%E7%B3%BB%E6%98%AF%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8D%20Webpack%20%E6%9E%B6%E6%9E%84%E7%9A%84%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>23 插件架构：Hook 体系是如何影响 Webpack 架构的？</span><!----><!--]--><!----></a><a class="VPLink link link active" href="/smallVolumesStore/webpack/24%20Init%E3%80%81Make%E3%80%81Seal%EF%BC%9A%E7%9C%9F%E6%AD%A3%E8%AF%BB%E6%87%82%20Webpack%20%E6%A0%B8%E5%BF%83%E6%B5%81%E7%A8%8B.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>24 Init、Make、Seal：真正读懂 Webpack 核心流程</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/25%20Dependency%20Graph%EF%BC%9A%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E9%97%B4%E4%BE%9D%E8%B5%96%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>25 Dependency Graph：如何管理模块间依赖？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/26%20Chunk%EF%BC%9A%E4%B8%89%E7%A7%8D%E4%BA%A7%E7%89%A9%E7%9A%84%E6%89%93%E5%8C%85%E9%80%BB%E8%BE%91.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>26 Chunk：三种产物的打包逻辑</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/27%20Runtime%EF%BC%9A%E6%A8%A1%E5%9D%97%E7%BC%96%E8%AF%91%E6%89%93%E5%8C%85%E5%8F%8A%E8%BF%90%E8%A1%8C%E6%97%B6%E9%80%BB%E8%BE%91.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>27 Runtime：模块编译打包及运行时逻辑</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/28%20Tree-shaking%EF%BC%9A%E5%A6%82%E4%BD%95%E5%88%A0%E9%99%A4%E6%97%A0%E7%94%A8%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%87%BA%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>28 Tree-shaking：如何删除无用模块导出？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/29%20Sourcemap%EF%BC%9A%E6%BA%90%E7%A0%81%E6%98%A0%E5%B0%84%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8A%80%E5%B7%A7.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>29 Sourcemap：源码映射原理与应用技巧</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/30%20HMR%EF%BC%9A%E5%A6%82%E4%BD%95%E5%8A%A8%E6%80%81%E6%9B%BF%E6%8D%A2%E9%A1%B5%E9%9D%A2%E4%BB%A3%E7%A0%81%EF%BC%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>30 HMR：如何动态替换页面代码？</span><!----><!--]--><!----></a><a class="VPLink link link" href="/smallVolumesStore/webpack/README.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>总结</span><!----><!--]--><!----></a><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-ca9ccb7e data-v-c95df128><div class="VPDoc has-sidebar has-aside" data-v-c95df128 data-v-f0af2311><div class="container" data-v-f0af2311><div class="aside" data-v-f0af2311><div class="aside-curtain" data-v-f0af2311></div><div class="aside-container" data-v-f0af2311><div class="aside-content" data-v-f0af2311><div class="VPDocAside" data-v-f0af2311 data-v-aea49c31><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline has-outline" data-v-aea49c31 data-v-a3de185c><div class="content" data-v-a3de185c><div class="outline-marker" data-v-a3de185c></div><div class="outline-title" data-v-a3de185c>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-a3de185c><span class="visually-hidden" id="doc-outline-aria-label" data-v-a3de185c> Table of Contents for current page </span><ul class="root" data-v-a3de185c><!--[--><li data-v-a3de185c><a class="outline-link" href="#初始化阶段" data-v-a3de185c>初始化阶段</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#构建阶段" data-v-a3de185c>构建阶段</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#生成阶段" data-v-a3de185c>生成阶段</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#资源形态流转" data-v-a3de185c>资源形态流转</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#总结" data-v-a3de185c>总结</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#思考题" data-v-a3de185c>思考题</a><!----></li><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-aea49c31></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-f0af2311><div class="content-container" data-v-f0af2311><!--[--><!--]--><main class="main" data-v-f0af2311><div style="position:relative;" class="vp-doc _smallVolumesStore_webpack_24%20Init%E3%80%81Make%E3%80%81Seal%EF%BC%9A%E7%9C%9F%E6%AD%A3%E8%AF%BB%E6%87%82%20Webpack%20%E6%A0%B8%E5%BF%83%E6%B5%81%E7%A8%8B" data-v-f0af2311><div><p>前面章节中，我们详细讲解了 Webpack 的基本应用、性能优化、Loader 与 Plugin 组件开发方方面面的知识，相信学习过这些内容之后，你已经对 Webpack 有相当深入的理解了，可以开始从更底层的视角，自底向上重新审视 Webpack 实现原理。</p><p>Webpack 的功能集非常庞大：模块打包、代码分割、按需加载、Hot Module Replacement、文件监听、Tree-shaking、Sourcemap、Module Federation、Dev Server、DLL、多进程打包、Persistent Cache 等等，但抛开这些花里胡哨的能力，最最核心的功能依然是：<strong>At its core, webpack is a static module bundler for modern</strong> <strong>JavaScript</strong> <strong>applications</strong>，也就是所谓的<strong>静态模块打包能力</strong>。</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f6c8846ed06646fdba24cc3053d66f5e~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><p>Webpack 能够将各种类型的资源 —— 包括图片、音视频、CSS、JavaScript 代码等，通通转译、组合、拼接、生成标准的、能够在不同版本浏览器兼容执行的 JavaScript 代码文件，这一特性能够轻易抹平开发 Web 应用时处理不同资源的逻辑差异，使得开发者以一致的心智模型开发、消费这些不同的资源文件。</p><p>打包功能的底层实现逻辑很复杂，抛去大多数分支逻辑后，大致包含如下步骤：</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a26d60df160440adae904dcdeefb44d7~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><p>为了方便理解，我把上述过程划分为三个阶段：</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3293ad8708e14a8db0567dac24fb8668~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><ol><li><strong>初始化阶段</strong>：修整配置参数，创建 Compiler、Compilation 等基础对象，并初始化插件及若干内置工厂、工具类，并最终根据 <code>entry</code> 配置，找到所有入口模块；</li><li><strong>构建阶段</strong>：从 <code>entry</code> 文件开始，调用 <code>loader</code> 将模块转译为 JavaScript 代码，调用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Facornjs%2Facorn" target="_blank" rel="noreferrer">Acorn</a> 将代码转换为 AST 结构，遍历 AST 从中找出该模块依赖的模块；之后 <strong>递归</strong> 遍历所有依赖模块，找出依赖的依赖，直至遍历所有项目资源后，构建出完整的 <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwebpack.js.org%2Fconcepts%2Fdependency-graph%2F" target="_blank" rel="noreferrer">模块依赖关系图</a></strong>；</li><li><strong>生成阶段</strong>：根据 <code>entry</code> 配置，将模块组装为一个个 Chunk 对象，之后调用一系列 Template 工厂类翻译 Chunk 代码并封装为 Asset，最后写出到文件系统。</li></ol><blockquote><p>提示：单次构建过程自上而下按顺序执行，如果启动了 <code>watch</code> ，则构建完成后不会退出 Webpack 进程，而是持续监听文件内容，发生变化时回到「<strong>构建</strong>」阶段重新执行构建。</p></blockquote><p>三个阶段环环相扣，「<strong>初始化</strong>」的重点是根据用户配置设置好构建环境；「<strong>构建阶段</strong>」则重在解读文件输入与文件依赖关系；最后在「<strong>生成阶段</strong>」按规则组织、包装模块，并翻译为适合能够直接运行的产物包。三者结合，实现 Webpack 最核心的打包能力，其它功能特性也几乎都是在此基础上，通过 Hook 介入、修改不同阶段的对象状态、流程逻辑等方式实现。</p><p>可以说，深度理解这三个阶段，才算是真正掌握了 Webpack 核心原理，所以接下来，让我们一起深入底层源码，剖析各阶段的具体实现。</p><h2 id="初始化阶段" tabindex="-1">初始化阶段 <a class="header-anchor" href="#初始化阶段" aria-hidden="true">#</a></h2><p>初始化阶段主要完成三个功能：修整 &amp; 校验配置对象、运行插件、调用 <code>compiler.compile</code> 方法开始执行构建操作，代码比较简单，如下图：</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/83d697220d324ed5a3ddba7e90d332ca~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><p>首先，校验用户参数，并合并默认配置对象：</p><ol><li>启动时，首先将 <code>process.args</code> 参数与 <code>webpack.config.js</code> 文件合并成用户配置；</li><li>调用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FvalidateSchema.js%23L77-L78" target="_blank" rel="noreferrer">validateSchema</a> 校验配置对象（<code>validateSchema</code> 底层依赖于 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fschema-utils" target="_blank" rel="noreferrer">schema-utils</a> 库）；</li><li>调用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2Fconfig%2Fnormalization.js%23L116-L117" target="_blank" rel="noreferrer">getNormalizedWebpackOptions</a> + <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2Fconfig%2Fdefaults.js%23L120-L121" target="_blank" rel="noreferrer">applyWebpackOptionsBaseDefaults</a> 合并出最终配置。</li></ol><p>之后，创建 Compiler 对象并开始启动插件：</p><ol><li><p>调用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2Fwebpack.js%23L61-L62" target="_blank" rel="noreferrer">createCompiler</a> 函数创建 <code>compiler</code> 对象。</p></li><li><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2Fwebpack.js%23L68-L69" target="_blank" rel="noreferrer">遍历</a> 配置中的 <code>plugins</code> 集合，执行插件的 <code>apply</code> 方法。</p></li><li><p>调用</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">new WebpackOptionsApply().process</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>方法，根据配置内容动态注入相应插件，包括：</p><ul><li>调用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FEntryOptionPlugin.js" target="_blank" rel="noreferrer">EntryOptionPlugin</a> 插件，该插件根据 <code>entry</code> 值注入 <code>DynamicEntryPlugin</code> 或 <code>EntryPlugin</code> 插件；</li><li>根据 <code>devtool</code> 值注入 Sourcemap 插件，包括：<code>SourceMapDevToolPlugin</code>、<code>EvalSourceMapDevToolPlugin</code> 、<code>EvalDevToolModulePlugin</code>；</li><li>注入 <code>RuntimePlugin</code> ，用于根据代码内容动态注入 webpack 运行时。</li></ul></li></ol><p><strong>最后，调用 <code>compiler.compile</code> 方法开始执行构建</strong>，这一步非常重要，源码：</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// webpack/lib/compiler.js </span></span>
<span class="line"><span style="color:#82AAFF;">compile</span><span style="color:#A6ACCD;">(callback) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">params</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">newCompilationParams</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">hooks</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">beforeCompile</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">callAsync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">params</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">compilation</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">newCompilation</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">params</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">hooks</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">make</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">callAsync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">compilation</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">hooks</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">finishMake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">callAsync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">compilation</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">nextTick</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">compilation</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">finish</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">              </span><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#A6ACCD;">compilation</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">seal</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">hooks</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">afterCompile</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">callAsync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">compilation</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">callback</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">callback</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">null,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">compilation</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>虽然 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FCompiler.js%23L1159-L1160" target="_blank" rel="noreferrer">compile</a> 方法并没有任何实质的功能逻辑，但它搭建起了后续构建流程框架：</p><ol><li>调用 <code>newCompilation</code> 方法创建 <code>compilation</code> 对象；</li><li>触发 <code>make</code> 钩子，紧接着 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FEntryPlugin.js%23L47-L49" target="_blank" rel="noreferrer">EntryPlugin</a> 在这个钩子中调用 <code>compilation</code> 对象的 <code>addEntry</code> 方法创建入口模块，主流程开始进入「<strong>构建阶段</strong>」；</li><li><code>make</code> 执行完毕后，触发 <code>finishMake</code> 钩子；</li><li>执行 <code>compilation.seal</code> 函数，进入「<strong>生成阶段</strong>」，开始封装 Chunk，生成产物；</li><li><code>seal</code> 函数结束后，触发 <code>afterCompile</code> 钩子，开始执行收尾逻辑。</li></ol><blockquote><p>提示：<code>compile</code> 函数是后续所有功能逻辑的起点，非常重要，请务必前往阅读 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FCompiler.js%23L1159-L1160" target="_blank" rel="noreferrer">源码</a>。</p></blockquote><p>调用 <code>compile</code> 函数触发 <code>make</code> 钩子后，初始化阶段就算是结束了，流程逻辑开始进入「<strong>构建阶段</strong>」。</p><h2 id="构建阶段" tabindex="-1">构建阶段 <a class="header-anchor" href="#构建阶段" aria-hidden="true">#</a></h2><p>「<strong>构建阶段</strong>」从 <code>entry</code> 模块开始递归解析模块内容、找出模块依赖，按图索骥逐步构建出项目整体 <code>module</code> 集合以及 <code>module</code> 之间的 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwebpack.js.org%2Fconcepts%2Fdependency-graph%2F" target="_blank" rel="noreferrer">依赖关系图</a>，这个阶段的主要作用就是读入并理解所有原始代码。</p><p>实现上，在上述「<strong>初始化阶段</strong>」的最后，<code>compiler.compile</code> 函数会触发 <code>compiler.hook.make</code> 钩子，<code>EntryPlugin</code> 监听该钩子并开始调用 <code>compilation.addEntry</code> 添加入口：</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">EntryPlugin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">apply</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">compiler</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entry</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">context</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// 创建入口 Dependency 对象</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dep</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">EntryPlugin</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createDependency</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">entry</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">compiler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hooks</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">make</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">tapAsync</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">EntryPlugin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">compilation</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">callback</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">compilation</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEntry</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dep</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">callback</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>addEntry</code> 之后的执行逻辑：</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1bf47933e15042deb0b2051d907847fa~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><ol><li><p>调用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FCompilation.js%23L1476-L1477" target="_blank" rel="noreferrer">handleModuleCreation</a>，根据文件类型构建 <code>module</code> 子类 —— 一般是 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FNormalModule.js" target="_blank" rel="noreferrer">NormalModule</a>；</p></li><li><p>调用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Floader-runner" target="_blank" rel="noreferrer">loader-runner</a> 转译 <code>module</code> 内容，将各类资源类型转译为 Webpack 能够理解的标准 JavaScript 文本；</p></li><li><p>调用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Facorn" target="_blank" rel="noreferrer">acorn</a> 将 JavaScript 代码解析为 AST 结构；</p></li><li><p>在</p><p>JavaScriptParser</p><p>类中遍历 AST，触发各种钩子，其中最关键的：</p><ol><li>遇到 <code>import</code> 语句时，触发 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2Fjavascript%2FJavascriptParser.js%23L1983-L1984" target="_blank" rel="noreferrer">exportImportSpecifier</a> 钩子；</li><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2Fdependencies%2FHarmonyExportDependencyParserPlugin.js%23L153-L154" target="_blank" rel="noreferrer">HarmonyExportDependencyParserPlugin</a> 监听该钩子，将依赖资源添加为 Dependency 对象；</li><li>调用 <code>module</code> 对象的 <code>addDependency</code>， 将 Dependency 对象转换为 Module 对象并添加到依赖数组中。</li></ol></li></ol><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/604e4c7e9dac4069be57bd3be9f9800c~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><ol><li>AST 遍历完毕后，调用 <code>module.handleParseResult</code> 处理模块依赖数组；</li><li>对于 <code>module</code> 新增的依赖，调用 <code>handleModuleCreate</code>，控制流回到第一步；</li><li>所有依赖都解析完毕后，构建阶段结束。</li></ol><p>过程中模块源码经历了 <code>module =&gt; ast =&gt; dependences =&gt; module</code> 的流转，先将源码解析为 AST 结构，再在 AST 中遍历 <code>import</code> 等模块导入语句，收集模块依赖数组 —— <code>dependences</code>，最后遍历 <code>dependences</code> 数组将 Dependency 转换为 Module 对象，之后递归处理这些新的 Module，直到所有项目文件处理完毕。</p><blockquote><p>提示：这个过程会调用 acorn 将模块内容 —— 包括 JS、CSS，甚至多媒体文件，解析为 AST 结构，所以需要使用 <code>loaders</code> 将不同类型的资源转译为标准 JavaScript 代码。</p></blockquote><p>这个递归处理流程是「<strong>构建阶段</strong>」的精髓，我们来看个例子，假设对于下图这种简单模块依赖关系：</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bdb0ecf9b1144117851a8279aabe59e2~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><p>其中 <code>index.js</code> 为 entry 文件，依赖于 a/b 文件；a 依赖于 c/d 文件。初始化编译环境之后，<code>EntryPlugin</code> 根据 <code>entry</code> 配置找到 <code>index.js</code> 文件，并调用 <code>compilation.addEntry</code> 函数将之添加为 Module 对象，触发构建流程，构建完毕后内部会生成这样的数据结构：</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/29c82d31f5a144f1a63def697453caa5~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><p>之后，调用 Acorn 将 <code>index.js</code> 代码解析为 AST，并遍历 AST 找到 <code>index.js</code> 文件的依赖：</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/42239b4cb1c24df9981ccb1477f60877~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><p>得到两个新的依赖对象：<code>dependence[a.js]</code> 与 <code>dependence[b.js]</code> ，这是下一步操作的关键线索，紧接着调用 <code>module[index.js]</code> 的 <code>handleParseResult</code> 函数处理这两个依赖对象，得到 a、b 两个新的 Module 对象：</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7066113b7aeb4f78bd21d67121e16602~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><p>接着，又触发 <code>module[a/b]</code> 的 <code>handleModuleCreation</code> 方法，从 <code>a.js</code> 模块中又解析到 <code>c.js/d.js</code> 两个新依赖，于是再继续调用 <code>module[a]</code> 的 <code>handleParseResult</code>，递归上述流程：</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cfc533ae9204df48bf70ebc2dfda0fa~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><p>最终得到 <code>a/b/c/d</code> 四个 Module 与对应的 Dependency 对象：</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8daff06d0ef544bd979b18b22d265735~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><blockquote><p>提示：Dependency、Module、Entry 等都是 Webpack 内部非常重要的基本类型，在后续章节中我们会单独展开这几个类型的基本涵义与相互之间的关系。</p></blockquote><p>到这里解析完所有模块，没有新的依赖后就可以继续推进，进入「生成阶段」。</p><h2 id="生成阶段" tabindex="-1">生成阶段 <a class="header-anchor" href="#生成阶段" aria-hidden="true">#</a></h2><p>「构建阶段」负责读入与分析源代码文件，将之一一转化为 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FModule.js" target="_blank" rel="noreferrer">Module</a>、<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FDependency.js" target="_blank" rel="noreferrer">Dependency</a> 对象，解决的是资源“输入”问题；而「生成阶段」则负责根据一系列内置规则，将上一步构建出的所有 Module 对象拆分编排进若干 Chunk 对象中，之后以 Chunk 粒度将源码转译为适合在目标环境运行的产物形态，并写出为产物文件，解决的是资源“输出”问题。</p><p>「生成阶段」发生在 <code>make</code> 阶段执行完毕，<code>compiler.compile</code> 调用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FCompilation.js%23L2780-L2781" target="_blank" rel="noreferrer">compilation.seal</a> 函数时：</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// webpack/lib/compiler.js </span></span>
<span class="line"><span style="color:#82AAFF;">compile</span><span style="color:#A6ACCD;">(callback) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">compilation</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">newCompilation</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">params</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">hooks</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">make</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">callAsync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">compilation</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">compilation</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">seal</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#676E95;">/* */</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>也就是说，<code>compilation.seal</code> 函数是「生成阶段」的入口函数，<code>seal</code> 原意密封、上锁，我个人理解在 Webpack 语境下接近于“将模块装进 Chunk”，核心流程：</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2657e3ff33214d3aac023556d8858c77~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><ol><li><p>创建本次构建的 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FChunkGraph.js" target="_blank" rel="noreferrer">ChunkGraph</a> 对象。</p></li><li><p>遍历</p><p>入口集合</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">compilation.entries</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>：</p><ol><li>调用 <code>addChunk</code> 方法为每一个入口 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FCompilation.js%23L2817-L2818" target="_blank" rel="noreferrer">创建</a> 对应的 Chunk 对象（EntryPoint Chunk）；</li><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FCompilation.js%23L2832-L2833" target="_blank" rel="noreferrer">遍历</a> 该入口对应的 Dependency 集合，<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FCompilation.js%23L2835-L2836" target="_blank" rel="noreferrer">找到</a> 相应 Module 对象并 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FCompilation.js%23L2837-L2838" target="_blank" rel="noreferrer">关联</a> 到该 Chunk。</li></ol></li><li><p>到这里可以得到若干 Chunk，之后调用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FbuildChunkGraph.js%23L1347-L1348" target="_blank" rel="noreferrer">buildChunkGraph</a> 方法将这些 Chunk 处理成 Graph 结构，方便后续处理。</p></li><li><p>之后，触发 <code>optimizeModules/optimizeChunks</code> 等钩子，由插件（如 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwebpack.js.org%2Fplugins%2Fsplit-chunks-plugin%2F" target="_blank" rel="noreferrer">SplitChunksPlugin</a>）进一步修剪、优化 Chunk 结构。</p></li><li><p>一直到最后一个 Optimize 钩子</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">optimizeChunkModules</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>执行完毕后，开始调用</p><p>compilation.codeGeneration</p><p>方法生成 Chunk 代码，在</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">codeGeneration</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>方法内部：</p><ol><li>遍历每一个 Chunk 的 Module 对象，调用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FCompilation.js%23L3297-L3298" target="_blank" rel="noreferrer">_codeGenerationModule</a>；</li><li><code>_codeGenerationModule</code> 又会继续往下调用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FModule.js%23L876-L877" target="_blank" rel="noreferrer">module.codeGeneration</a> 生成单个 Module 的代码，这里注意不同 Module 子类有不同 <code>codeGeneration</code> 实现，对应不同产物代码效果。</li></ol></li></ol><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d3fe03a7c0c745e199d1b4c3f817c955~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><ol><li>所有 Module 都执行完 <code>codeGeneration</code>，生成模块资产代码后，开始调用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FCompilation.js%23L4520-L4521" target="_blank" rel="noreferrer">createChunkAssets</a> 函数，为每一个 Chunk 生成资产文件。</li><li>调用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FCompilation.js%23L4638-L4639" target="_blank" rel="noreferrer">compilation.emitAssets</a> 函数“<strong>提交</strong>”资产文件，注意这里还只是记录资产文件信息，还未写出磁盘文件。</li><li>上述所有操作正常完成后，触发 <code>callback</code> 回调，控制流回到 <code>compiler</code> 函数。</li><li>最后，<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FCompiler.js%23L466-L467" target="_blank" rel="noreferrer">调用</a> <code>compiler</code> 对象的 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub1s.com%2Fwebpack%2Fwebpack%2Fblob%2FHEAD%2Flib%2FCompiler.js%23L592-L593" target="_blank" rel="noreferrer">emitAssets</a> 方法，输出资产文件。</li></ol><p><code>seal</code> 很复杂，重点在于将 Module 按入口组织成多个 Chunk 对象，之后暴露 <code>optimizeXXX</code> 钩子，交由插件根据不同需求对 Chunk 做进一步修剪、整形、优化，最后按 Chunk 为单位做好代码合并与转换，输出为资产文件。</p><blockquote><p>提示：上述 <code>optimizeXXX</code> 钩子常被用于优化最终产物代码，例如 SplitChunksPlugin 就可以在这里分析 Chunk、Module 关系，将使用率较高的 Module 封装进新的 Chunk，实现 Common Chunk 效果。</p></blockquote><p>简单理解，Entry 与 Chunk 一一对应，而 Chunk 与最终输出的资源一一对应，我们来看个示例，假如有这样的配置：</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// webpack.config.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">a</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src/a.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">b</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src/b.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>实例配置中有两个入口，对应的文件结构：</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/150a2a6fd43f401a806b61975f69ce42~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><p>a 依赖于 c/e；b 依赖于 c/d；a/b 同时依赖于 c。最终生成的 Chunk 结构为：</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/58b94810c0df4ea485f9ab2c07c1d700~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><p>也就是根据依赖关系，<code>chunk[a]</code> 包含了 a/c/e 三个模块，<code>chunk[b]</code> 包含了 b/c/d 三个模块。</p><p><code>seal</code> 过程中会不断调用 <code>compilation.emitAssets</code> 提交资产记录，而直到 <code>seal</code> 结束后则调用 <code>compiler.emitAssets</code> 函数，函数内部调用 <code>compiler.outputFileSystem.writeFile</code> 方法将 <code>assets</code> 集合写入文件系统，Webpack 完成从源码到资产文件的转换，构建工作至此结束。</p><h2 id="资源形态流转" tabindex="-1">资源形态流转 <a class="header-anchor" href="#资源形态流转" aria-hidden="true">#</a></h2><p>OK，上面我们已经把逻辑层面的构造主流程梳理完了，最后我们再结合<strong>资源形态流转</strong>的角度重新考察整个过程，加深理解：</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/defaaadcd2f04cf4ae950a746455a86d~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?" alt="image.png"></p><ul><li><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">compiler.make</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>阶段：</p><ul><li><code>entry</code> 文件以 <code>dependence</code> 对象形式加入 <code>compilation</code> 的依赖列表，<code>dependence</code> 对象记录了 <code>entry</code> 的类型、路径等信息；</li><li>根据 <code>dependence</code> 调用对应的工厂函数创建 <code>module</code> 对象，之后读入 <code>module</code> 对应的文件内容，调用 <code>loader-runner</code> 对内容做转化，转化结果若有其它依赖则继续读入依赖资源，重复此过程直到所有依赖均被转化为 <code>module</code>。</li></ul></li><li><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">compilation.seal</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>阶段：</p><ul><li>遍历 <code>module</code> 集合，根据 <code>entry</code> 配置及引入资源的方式，将 <code>module</code> 分配到不同的 Chunk；</li><li>Chunk 之间最终形成 ChunkGraph 结构；</li><li>遍历 ChunkGraph，调用 <code>compilation.emitAsset</code> 方法标记 <code>chunk</code> 的输出规则，即转化为 <code>assets</code> 集合。</li></ul></li><li><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">compiler.emitAssets</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>阶段：</p><ul><li>将 <code>assets</code> 写入文件系统。</li></ul></li></ul><p>这个过程用到很多 Webpack 基础对象，包括：</p><ul><li><code>Entry</code>：编译入口；</li><li><code>Compiler</code>：编译管理器，Webpack 启动后会创建 <code>compiler</code> 对象，该对象一直存活直到构建结束进程退出；</li><li><code>Compilation</code>：单次构建过程的管理器，比如 <code>watch = true</code> 时，运行过程中只有一个 <code>compiler</code>，但每次文件变更触发重新编译时，都会创建一个新的 <code>compilation</code> 对象；</li><li><code>Dependence</code>：依赖对象，记录模块间依赖关系；</li><li><code>Module</code>：Webpack 内部所有资源都会以 Module 对象形式存在，所有关于资源的操作、转译、合并都是以 Module 为单位进行的；</li><li><code>Chunk</code>：编译完成准备输出时，将 Module 按特定的规则组织成一个一个的 Chunk。</li></ul><p>这里简单了解即可，后面章节中我们还会继续挖掘不同对象的作用与细节。</p><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-hidden="true">#</a></h2><p>综上，Webpack 底层源码非常复杂，但撇除所有分支逻辑后，构建主流程可以简单划分为三个阶段：</p><ul><li><strong>初始化阶段</strong>：负责设置构建环境，初始化若干工厂类、注入内置插件等；</li><li><strong>构建阶段</strong>：读入并分析 Entry 模块，找到模块依赖，之后递归处理这些依赖、依赖的依赖，直到所有模块都处理完毕，这个过程解决资源“输入”问题；</li><li><strong>生成阶段</strong>：根据 Entry 配置将模块封装进不同 Chunk 对象，经过一系列优化后，再将模块代码翻译成产物形态，按 Chunk 合并成最终产物文件，这个过程解决资源“输出”问题。</li></ul><p>这个过程串起资源「输入」到「输出」的关键步骤，可以说是 Webpack 最重要的流程骨架，没有之一！所以建议你务必跟随上述各个阶段的介绍，翻阅源码中对应的具体代码，深度理解 Webpack 构建功能的实现细节。</p><p>在后面章节中，我还会在这个流程骨架基础上，继续展开一些有代表性的对象、分支、功能实现逻辑，帮助你更体系化理解 Webpack 实现原理。</p><h2 id="思考题" tabindex="-1">思考题 <a class="header-anchor" href="#思考题" aria-hidden="true">#</a></h2><p>在「构建阶段」，为什么需要先将依赖文件构建为 Dependency，之后再根据 Dependency 创建文件对应的 Module 对象？Dependency 对象到底有什么作用？欢迎在留言区讨论。</p></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-f0af2311 data-v-a54a85bd><!----><div class="prev-next" data-v-a54a85bd><div class="pager" data-v-a54a85bd><a class="pager-link prev" href="/smallVolumesStore/webpack/23%20%E6%8F%92%E4%BB%B6%E6%9E%B6%E6%9E%84%EF%BC%9AHook%20%E4%BD%93%E7%B3%BB%E6%98%AF%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8D%20Webpack%20%E6%9E%B6%E6%9E%84%E7%9A%84%EF%BC%9F.html" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Previous page</span><span class="title" data-v-a54a85bd>23 插件架构：Hook 体系是如何影响 Webpack 架构的？</span></a></div><div class="has-prev pager" data-v-a54a85bd><a class="pager-link next" href="/smallVolumesStore/webpack/25%20Dependency%20Graph%EF%BC%9A%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E9%97%B4%E4%BE%9D%E8%B5%96%EF%BC%9F.html" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Next page</span><span class="title" data-v-a54a85bd>25 Dependency Graph：如何管理模块间依赖？</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"design_1 开篇：前端工程师的成长论.md\":\"745603d2\",\"design_2 设计模式的“道”与“术”.md\":\"fac5379c\",\"design_3 创建型：工厂模式·简单工厂——区分“变与不变”.md\":\"967b7c99\",\"design_4 创建型：工厂模式·抽象工厂——理解“开放封闭”.md\":\"8cc76f3a\",\"design_5 创建型：单例模式——vuex的数据管理哲学.md\":\"6a7a0323\",\"design_6 创建型：单例模式——面试真题手把手教学.md\":\"c7ef0cae\",\"design_7 创建型：原型模式——谈prototype无小事.md\":\"ac082525\",\"design_8 结构型：装饰器模式——对象装上它，就像开了挂.md\":\"18f1f6e7\",\"design_9 结构型：装饰器模式——深入装饰器原理与优秀案例.md\":\"f792bdc9\",\"design_readme.md\":\"f08c4f92\",\"design_面试题.md\":\"8c43b943\",\"electron_1.开篇-技术选型和项目结构.md\":\"0fb6af19\",\"electron_10.业务篇-简历制作之工具条模块与简历模版之间通信.md\":\"bc138064\",\"electron_11.业务篇-简历制作之数据的录入与展示.md\":\"467e4d07\",\"electron_12.业务篇-简历制作之导出pdf.md\":\"d6bae0b2\",\"electron_13.支线篇-打包生成第一个桌面应用.md\":\"446cdd39\",\"electron_14.业务篇-简历模版列表实现与侧边栏交互效果.md\":\"af67890f\",\"electron_15.业务篇-首页主题换肤功能实现且hooks优化逻辑.md\":\"bb92d1b0\",\"electron_16.业务篇-首页主题换肤功能实现且hooks优化逻辑.md\":\"20477c74\",\"electron_17.业务篇-简历数据存档且自定义存储路径（多窗口）.md\":\"17f6461a\",\"electron_18.业务篇-思考并补全遗漏的功能细节，整体优化代码，让应用更健壮.md\":\"9ed8ea61\",\"electron_19.优化篇-公共弹窗拆解优化，让职能更加单一.md\":\"1c24e1c7\",\"electron_2.基础篇-electron初步认识并掌握基础知识.md\":\"4f66ffa8\",\"electron_20定制篇-自定义electron原生应用菜单.md\":\"74e197e9\",\"electron_21.打包篇-应用程序生产环境构建.md\":\"184e0231\",\"electron_22.打包篇-生产环境疑难杂症的解决.md\":\"610d3c40\",\"electron_23.打包篇-webpack打包优化.md\":\"49a32c97\",\"electron_24.打包篇-electron打包体积 优化.md\":\"fb94706b\",\"electron_25.到达目的地-应用程序发布.md\":\"9b723254\",\"electron_26.结尾篇-行而不辍，未来可期.md\":\"18f3d5a2\",\"electron_27.彩蛋篇-webpack基础介绍与两大利器.md\":\"c3d5e28c\",\"electron_28.彩蛋篇-rcreduxmodel中间件开发设计.md\":\"dacd276e\",\"electron_29.期望篇-可视化自定义独特的简历模版.md\":\"a8786734\",\"electron_3.设计篇-需求功能设计与数据存储方案设计.md\":\"787763c3\",\"electron_30.问题篇-常见问题解决.md\":\"19ac8b03\",\"electron_4.环境篇-动手搭建我们的简历平台.md\":\"62cf1bc7\",\"electron_5.500米里程碑｜环境搭建篇完.md\":\"cbcc1794\",\"electron_6.业务篇-首页开发，好的印象篇.md\":\"2b29de51\",\"electron_7.业务篇-如何写我们的redux与file.md\":\"e5d96580\",\"electron_8.业务篇-简历制作之常用组件设计与简历数据设计.md\":\"89bba51c\",\"electron_9.业务篇-简历制作之入口页面开发.md\":\"cbc02a98\",\"electron_readme.md\":\"d08b808f\",\"index.md\":\"4bea185c\",\"tsguide_1.开篇：用正确的方式学习 typescript.md\":\"f52d6c03\",\"tsguide_10.结构化类型系统：类型兼容性判断的幕后.md\":\"3fb328c8\",\"tsguide_2.工欲善其事：打造最舒适的 typescript 开发环境.md\":\"ac561665\",\"tsguide_3.进入类型的世界：理解原始类型与对象类型.md\":\"7d26daee\",\"tsguide_4.掌握字面量类型与枚举，让你的类型再精确一些.md\":\"5a7850b9\",\"tsguide_5.函数与 class 中的类型：详解函数重载与面向对象.md\":\"18118712\",\"tsguide_6.探秘内置类型：any、unknown、never 与类型断言.md\":\"8ae83eab\",\"tsguide_7.类型编程好帮手：typescript 类型工具（上）.md\":\"819a4367\",\"tsguide_8.类型编程好帮手：typescript 类型工具（下）.md\":\"4ede58c7\",\"tsguide_9.类型编程基石：typescript 中无处不在的泛型.md\":\"a576580f\",\"webpack_1 重新认识 webpack：旧时代的破局者.md\":\"ae96c5f3\",\"webpack_10 深入理解图像加载原理与最佳实践.md\":\"b2a17760\",\"webpack_11 深入理解 webpack 核心配置结构.md\":\"85e170c9\",\"webpack_12 构建性能：分享 7 款常用的性能分析工具.md\":\"46f79cee\",\"webpack_13 如何使用 webpack 持久化缓存大幅提升构建性能？.md\":\"883d7133\",\"webpack_14 webpack 都有哪些实现并行构建的方法？.md\":\"0ece7140\",\"webpack_15 有哪些值得学习的构建性能极致优化技巧？.md\":\"118a2c22\",\"webpack_16 如何正确使用 splitchunks提升应用性能？.md\":\"e0880d5c\",\"webpack_17 不止 terser：揭秘代码压缩的门门道道.md\":\"239b988b\",\"webpack_18 还有哪些值得学习的应用性能极致优化技巧？.md\":\"02ff6167\",\"webpack_19 loader 开发基础：从开源项目学到的 loader 开发技巧.md\":\"1e4c3a53\",\"webpack_2 如何理解 webpack 配置底层结构逻辑.md\":\"4067c9d3\",\"webpack_20 loader 开发进阶：如何用好 loader 扩展开发工具？.md\":\"c9fea87a\",\"webpack_21 插件开发基础：实例剖析插件基本形态与架构逻辑.md\":\"5cacb3af\",\"webpack_22 插件开发进阶：如何提升插件健壮性？.md\":\"c3e6bf4b\",\"webpack_23 插件架构：hook 体系是如何影响 webpack 架构的？.md\":\"6a9e7a3e\",\"webpack_24 init、make、seal：真正读懂 webpack 核心流程.md\":\"58bb3c7c\",\"webpack_25 dependency graph：如何管理模块间依赖？.md\":\"fd8198b4\",\"webpack_26 chunk：三种产物的打包逻辑.md\":\"29be3c0c\",\"webpack_27 runtime：模块编译打包及运行时逻辑.md\":\"370cba83\",\"webpack_28 tree-shaking：如何删除无用模块导出？.md\":\"6b21a6f4\",\"webpack_29 sourcemap：源码映射原理与应用技巧.md\":\"d32ec826\",\"webpack_3 如何借助 babel ts eslint 构建现代 js 工程环境？.md\":\"0e12a070\",\"webpack_30 hmr：如何动态替换页面代码？.md\":\"8925cb42\",\"webpack_4 如何借助预处理器、postcss 等构建现代 css 工程环境？.md\":\"c0084fe6\",\"webpack_5 如何搭建 vue 全栈开发环境？.md\":\"7b1c6038\",\"webpack_6 如何搭建 react 全栈开发环境？.md\":\"55a9cb9e\",\"webpack_7 使用 webpack 构建 npm library 的正确方式.md\":\"9deeef31\",\"webpack_8 使用 webpack 构建微前端应用.md\":\"6d5df1df\",\"webpack_9 如何借助 webpack 开发 pwa、node、electron 应用？.md\":\"22b5407e\",\"webpack_readme.md\":\"0aa9400e\"}")</script>
    <script type="module" async src="/smallVolumesStore/assets/app.02b33377.js"></script>
    
  </body>
</html>